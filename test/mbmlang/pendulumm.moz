include Pendulum_Common

def fi, th, ps: Real
def om_x, om_y, om_z: Real

def gg = mkVector(0., 9.81, 0.)
def om = mkVector(0., 0., om_z)
def dom = mkVector(0., 0., om_z')
def dth = mkVector(0., 0., th')
def R = R_z(th)
def r = mkVector((-1.), 0., 0.)
def rr = R * r

def t_1 = (ss rr) * ((ss dom) * rr)
def t_2 = (ss rr) * ((ss om) * ((ss om) * rr))
def t_3 = (ss rr) * gg

def model = [
  dom + t_1 + t_2 - t_3,
  dth - om
]

def _ = iter (fun M: MatrixMapSReal -> def _ = dp M; ()) model

// def rs = concat (concat (map (fun M: MatrixMapSReal -> matrixToList M) model))
// def _ = writeFile MODEL_FILENAME (exportModelica "Pendulum" rs (listToMap []))
// def _ = println (exportMatlab2 rs)
