
/*
Modeling Kernel Language (Modelyze) library
Copyright (C) 2010-2012 David Broman

Modelyze library is free software: you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

Modelyze library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License
along with Modelyze library.  If not, see <http://www.gnu.org/licenses/>.

written by Oscar Eriksson oerikss@kth.se
*/

include PlanarMech
include Simulation

def g = -9.81
def n_1, n_2: Node

def zz = mmRealZero (3, 1)
def g0 = listToMatrix [[0.], [-g]] (mmRealZero (3, 1))

def x_m, y_m, t_m, Fx_m, Fy_m, T_m: Real
def aa_m = listToMatrix [[x_m], [y_m], [t_m]] (mmSRealZero (3, 1))
def tt_m = listToMatrix [[Fx_m], [Fy_m], [T_m]] (mmSRealZero (3, 1))
def terminal_m = listToMatrix [[Fx_m - x_m''], [Fy_m - y_m''], [T_m - t_m'']] (mmSRealZero (3, 1))

def x_g, y_g, t_g, Fx_g, Fy_g, T_g: Real
def aa_g = listToMatrix [[x_g], [y_g], [t_g]] (mmSRealZero (3, 1))
def tt_g = listToMatrix [[Fx_g], [Fy_g], [T_g]] (mmSRealZero (3, 1))
def terminal_g = listToMatrix [[Fx_g], [Fy_g - g], [T_g]] (mmSRealZero (3, 1))

def pm = mkPlanarMechModelEdge (n_1, n_2) ((aa_m, zz), (tt_m, zz)) terminal_m
def gf = mkPlanarMechModelEdge (n_2, n_1) ((aa_g, zz), (tt_g, g0)) terminal_g

def model = [pm, gf]

def main = {
  def res = mkResiduals model;
  def ivs = mkInitVals model;
  def lbls = [(x_m, "x"), (y_m, "y")];
  def m = mkHModel res ivs;
  simulate m (0., 3.) 0.01 lbls
}
