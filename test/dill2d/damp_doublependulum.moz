include DILLEXPORT
include DILLSIM

def n_1, n_2, n_3, n_4, n_5, n_6, n_7: Node

def m_1 = 1.
def I_1 = 1.
def x_m1, y_m1: Real
def vx_m1, vy_m1: Real
def Fx_m1, Fy_m1: Real
def th_m1, om_m1, T_m1: Real
def rr_m1 = vec x_m1 y_m1
def vv_m1 = vec vx_m1 vy_m1
def FF_m1 = vec Fx_m1 Fy_m1

def b_1 = BodyInGravity m_1
                      I_1
                      rr_m1
                      vv_m1
                      FF_m1
                      th_m1
                      om_m1
                      T_m1
                      n_1 n_3

def m_2 = 1.
def I_2 = 1.
def x_m2, y_m2: Real
def vx_m2, vy_m2: Real
def Fx_m2, Fy_m2: Real
def th_m2, om_m2, T_m2: Real
def rr_m2 = vec x_m2 y_m2
def vv_m2 = vec vx_m2 vy_m2
def FF_m2 = vec Fx_m2 Fy_m2

def b_2 = BodyInGravity m_2
                      I_2
                      rr_m2
                      vv_m2
                      FF_m2
                      th_m2
                      om_m2
                      T_m2
                      n_1 n_6

def l_1 = 1.
def ra_1 = ARigidArm l_1 n_1 n_2 n_3
def D_1 = 4.
def drj_1 = ADampedRevoluteJoint D_1 n_1 n_2

def l_2 = 1.
def ra_2 = ARigidArm l_2 n_1 n_3 n_4

def D_2 = 2.
def drj_2 = ADampedRevoluteJoint D_2 n_4 n_5
def l_3 = 1.
def ra_3 = ARigidArm l_3 n_1 n_5 n_6

def m = drj_1; ra_1; b_1; ra_2; drj_2; ra_3; b_2
  ; x_m1 <- l_1
  ; x_m2 <- l_1 + l_2 + l_3

def main = {
  // exportDill2Modelica "Double_Pendulum" m
  simulate m (0., 30.) 0.01
    [(x_m2, "x_m2"), (y_m2, "y_m2")]
}
