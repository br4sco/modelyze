/*
Modeling Kernel Language (Modelyze) library
Copyright (C) 2010-2012 David Broman

Modelyze library is free software: you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

Modelyze library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License
along with Modelyze library.  If not, see <http://www.gnu.org/licenses/>.

written by Oscar Eriksson oerikss@kth.se
*/

include EquationsFormulation

def u_V, i_V, u_R, i_R, u_C, i_C, V: Vector

def A = listToMatrix [[-1.], [-1.]] (mmRealZero (2, 1))
def X = listToMatrix [[u_V], [u_R], [u_C]] (mmVectorZero (3, 1))
def Y = listToMatrix [[i_V], [i_R], [i_C]] (mmVectorZero (3, 1))
def terminals = listToMap [(u_V, V), (u_R, i_R), (i_R, u_R), (i_C, u_C)]

def main = {

  def terminals = mkVar2VarsMap terminals;
  def branchchords = ( mkVar2VarsMap (mkBranchChordSubs [(A, (X, Y))]));
  def _ = dprint(findLoop terminals branchchords u_R);
  def _ = dprint(findLoop terminals branchchords u_V);
  def _ = dprint(findLoop terminals branchchords u_C);

  def _ = dprint(findLoop terminals branchchords i_R);
  def _ = dprint(findLoop terminals branchchords i_V);
  def _ = dprint(findLoop terminals branchchords i_C);

  def (A, (X, Y)) = removeLoop terminals u_R (A, (X, Y));
  def _ = dp A;
  def _ = dp X;
  def _ = dp Y;

  def (A, (X, Y)) = removeLoops (mkVar2VarsMap terminals) (A, (X, Y));
  def _ = dp A;
  def _ = dp X;
  def _ = dp Y;
  ()
}
